(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{370:function(v,_,t){"use strict";t.r(_);var r=t(17),s=Object(r.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h1",{attrs:{id:"分片集群的设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分片集群的设计"}},[v._v("#")]),v._v(" 分片集群的设计")]),v._v(" "),_("h2",{attrs:{id:"分片集群规划步骤"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分片集群规划步骤"}},[v._v("#")]),v._v(" 分片集群规划步骤")]),v._v(" "),_("ol",[_("li",[v._v("确认是否需要分片")]),v._v(" "),_("li",[v._v("估算出大概需要多少片")]),v._v(" "),_("li",[v._v("了解数据的分布规则")]),v._v(" "),_("li",[v._v("确认需要分片的表")]),v._v(" "),_("li",[v._v("为需要分片的表选择片键")]),v._v(" "),_("li",[v._v("使用合适的均衡策略")])]),v._v(" "),_("h2",{attrs:{id:"分片的参考标准"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分片的参考标准"}},[v._v("#")]),v._v(" 分片的参考标准")]),v._v(" "),_("ol",[_("li",[v._v("数据量的大小一般不应该超过3TB,尽可能保持2TB一个分片")]),v._v(" "),_("li",[v._v("分片上的常用索引必须能容纳进内存")]),v._v(" "),_("li",[v._v("业务压力增大时，如CPU,RAM,磁盘中的任一项出现瓶颈时，可考滤加分片解决")])]),v._v(" "),_("h2",{attrs:{id:"分片数量的估算"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分片数量的估算"}},[v._v("#")]),v._v(" 分片数量的估算")]),v._v(" "),_("ol",[_("li",[_("p",[v._v("公式")]),v._v(" "),_("p",[v._v("res1 = 存储总量/单服务器可挂载容量"),_("br"),v._v("\nres2 = 工作集的大小/单服务器内存容量"),_("br"),v._v("\nres3 = 并发量总数/(单服务器并发量 * 0.7)"),_("br"),v._v("\n分片数量 = max(res1,res2,res3)")]),v._v(" "),_("p",[v._v("备注：工作集指热数据加索引")])]),v._v(" "),_("li",[_("p",[v._v("例子")]),v._v(" "),_("p",[v._v("假设需要存储总量大概8TB的数据，单台服务器可保存2TB的数据，则 res1=8Tb/2TB=4"),_("br"),v._v("\n假设热数据加索引大小为400GB,单台服务器的内存容量为256G，mongodb默认使用内存的60%来缓存数据 则 res2=400G/(256G * 0.6)≈3"),_("br"),v._v("\n假设高峰期的并发总数为3万/s，单服务器并发总数为9000/s,预留30%额外资源开销被集群占用，则res3=30000/(9000*0.7)≈5"),_("br"),v._v("\n则最终的分片数为：max(4,3,5)=5")])])]),v._v(" "),_("h2",{attrs:{id:"分片的考虑"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分片的考虑"}},[v._v("#")]),v._v(" 分片的考虑")]),v._v(" "),_("ol",[_("li",[v._v("是否需要跨机房分布")]),v._v(" "),_("li",[v._v("是否需要容灾")]),v._v(" "),_("li",[v._v("高可用的要求")])]),v._v(" "),_("h2",{attrs:{id:"影响片键效率的因素"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#影响片键效率的因素"}},[v._v("#")]),v._v(" 影响片键效率的因素")]),v._v(" "),_("ol",[_("li",[v._v("片键值的基数(Cardinality)， 应该取基数大的为片键")]),v._v(" "),_("li",[v._v("片键取值的分布，应该尽可能选择值均匀分布的为片键")]),v._v(" "),_("li",[v._v("避免单调递增或递减的片片键")]),v._v(" "),_("li",[v._v("分散写，集中读")]),v._v(" "),_("li",[v._v("被尽可能多的业务场景用到")])]),v._v(" "),_("Vssue",{attrs:{title:v.$title,options:{locale:"zh"}}})],1)}),[],!1,null,null,null);_.default=s.exports}}]);