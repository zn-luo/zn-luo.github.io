(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{404:function(t,s,a){"use strict";a.r(s);var e=a(17),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/pods/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Pod"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Pod 是Kubernetes项目中最小的API对象，即是Kubernetes项目的原子调度单位。Pod是一个或多个容器的组，具有共享的存储/网络资源，以及关于如何运行容器的规范。Pod的共享上下文是一组Linux名称空间、cgroups和可能的其他方面的隔离——与Docker容器隔离相同的事情。就Docker概念而言要，Pod类似于一组具有共享名称空间和共享文件系统卷的Docker容器。")]),t._v(" "),s("h2",{attrs:{id:"pods的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pods的使用"}},[t._v("#")]),t._v(" pods的使用")]),t._v(" "),s("p",[t._v("一般情况我们不需要直接创建pod来使用，而是通过工作负载资源(如"),s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Deployment"),s("OutboundLink")],1),t._v("或者"),s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/controllers/job/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Job"),s("OutboundLink")],1),t._v("等)来创建pods。如果创建的pods需要跟踪状态的可以使用"),s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/",target:"_blank",rel:"noopener noreferrer"}},[t._v("StatefulSet"),s("OutboundLink")],1),t._v("资源。")]),t._v(" "),s("p",[t._v("k8s集群使用pods的主要两种方式：")]),t._v(" "),s("ol",[s("li",[t._v("pod运行单个容器。")]),t._v(" "),s("li",[t._v("pod运行多个需要协调工作的容器：Pod可以封装由多个位于同一位置的紧密耦合且需要共享资源的容器组成的应用程序。这些位于同一位置的容器形成了单个内聚服务单元。如一个容器将存储在共享卷中的数据向外提供服务，而另一个sidecar容器刷新或更新这些文件。Pod将这些容器、存储资源和短暂的网络标识包装为一个单独的单元。")])]),t._v(" "),s("h2",{attrs:{id:"pod几个重要字段的含义和用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pod几个重要字段的含义和用法"}},[t._v("#")]),t._v(" pod几个重要字段的含义和用法")]),t._v(" "),s("ol",[s("li",[s("p",[s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/",target:"_blank",rel:"noopener noreferrer"}},[t._v("NodeSelector"),s("OutboundLink")],1),t._v("： 此字段的作用是将 Pod 与 Node 进行绑定的字段。如下所示:")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IfNotPresent\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("disktype")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ssd\n")])])]),s("p",[t._v("意味着这个 Pod 永远只能运行在携带了“disktype: ssd”标签（Label）的节点 上；否则，它将调度失败。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/",target:"_blank",rel:"noopener noreferrer"}},[t._v("HostAliases"),s("OutboundLink")],1),t._v(": 定义 Pod 的 hosts 文件（比如 /etc/hosts）里的内容。如下所示:")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hostaliases"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restartPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Never\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostAliases")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ip")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10.0.1.2"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostnames")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rs0.mongo"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rs1.mongo"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("hosts\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cat\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/hosts"')]),t._v("\n")])])]),s("p",[t._v("在这个 Pod 的 YAML 文件中，设置了一组 IP 和 hostname 的数据。这个 Pod 启动后，/etc/hosts 文件的内容将如下所示,最下面两行记录，就是通过 HostAliases 字段为 Pod 设置的："),s("br"),t._v(" "),s("img",{attrs:{src:"/imgs/k8s/hostaliases-pod.png",alt:"hostAliases"}}),s("br"),t._v("\n备注：在 Kubernetes 项目中，如果要设置 hosts 文件里的内容，一定要通过HostAliases设置。")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/",target:"_blank",rel:"noopener noreferrer"}},[t._v("shareProcessNamespace"),s("OutboundLink")],1),t._v(": Pod的设计目的是要让它里面的容器尽可能多地共享 Linux Namespace，仅保留必要的隔离和限制能力，所以凡是跟容器的 Linux Namespace 相关的属性，也一定是 Pod 级别的设置。这样Pod就能模拟出虚拟机里程序间的关系效果。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shareProcessNamespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" shell\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" busybox\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("securityContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("capabilities")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" SYS_PTRACE\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stdin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);